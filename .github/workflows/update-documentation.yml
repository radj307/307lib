name: Update Documentation

on:
  push:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      is-dry-run:
        type: boolean
        required: false
        default:  'false'

jobs:
  update-documentation:
    runs-on: ubuntu-latest

    steps:
      # Clone the repository
      - uses: actions/checkout@v2
        with:
          submodules: recursive
          persist-credentials: false
      
      # Clone the gh-pages branch into ./307lib/gh-pages
      - name: 'Clone the Documentation'
        run:  git clone --single-branch --branch gh-pages https://github.com/radj307/307lib gh-pages

      - name: 'Print Debugging Information'
        run:  |
              echo ${{github.workspace}}
              echo "########## github.workspace:"
              ls -lAgh ${{github.workspace}}
              echo "########## WORKING DIRECTORY:"
              ls -lAgh ./

      - name: Run doxygen
        uses: radj307/action-doxygen@v1.2
        with:
          working-dir: ${{github.workspace}}/gh-pages

      - name: Commit Changes
        if:   github.event.inputs.is-dry-run == false
        run:  |
              cd ./gh-pages
              git add -A
              git commit -m "Update Documentation"
              git push -u origin gh-pages
